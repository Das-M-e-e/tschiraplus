<UserControl xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:UI.ViewModels"
        x:Class="UI.Views.TaskListView"
        x:DataType="vm:TaskListViewModel">
    
    <UserControl.Styles>
        <Style Selector="FlyoutPresenter.taskDetailFlyout">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="{Binding #RootGrid.Bounds.Width, Mode=OneWay, Converter={StaticResource FlyoutOffsetConverter}}"/>
            <Setter Property="MaxWidth" Value="{Binding #RootGrid.Bounds.Width, Mode=OneWay}"/>
            <Setter Property="Height" Value="{Binding #RootGrid.Bounds.Height, Mode=OneWay, Converter={StaticResource FlyoutOffsetConverter}}"/>
            <Setter Property="MaxHeight" Value="{Binding #RootGrid.Bounds.Height, Mode=OneWay}"/>
        </Style>
    </UserControl.Styles>
    
    <Grid RowDefinitions="Auto,Auto,*,Auto" Name="RootGrid">
        
        <!-- Top Bar -->
        <Grid Grid.Row="0">
            <Border CornerRadius="15" Margin="10,20,10,0" Height="34">
                <StackPanel Height="34" Width="34" 
                    HorizontalAlignment="Left" Orientation="Horizontal">
                    <Image Source="avares://UI/Assets/kanban_fill_icon.png"
                           Stretch="Fill" Width="18" Height="16" Margin="20,0, 0,0" />
                    <TextBlock Text="List View" FontSize="12" FontWeight="Regular"
                               Margin="10,10,0,20" HorizontalAlignment="Left" Width="150" />
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- Search/Sort/Filter Bar -->
        <Grid Grid.Row="1">
            <TextBox Text="{Binding UserInput}"
                     KeyDown="SearchBar_KeyDown" 
                     Watermark="Search/Sort/Filter" 
                     MaxWidth="500" MinWidth="300" Margin="0,10" />
        </Grid>
        
        <!-- Main Area -->
        <Grid Grid.Row="2" Background="#1a1c20">
            <Grid ColumnDefinitions="Auto,*">
                <!-- Tasks Area -->
                <ScrollViewer Grid.Column="1">
                    <ItemsControl ItemsSource="{Binding Tasks}" Margin="250,8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:TaskViewModel">
                                <Button Command="{Binding OpenTaskDetailCommand}"
                                        Click="OnEditButtonPressed"
                                        HorizontalAlignment="Stretch" Margin="10,4">
                                    <Border Padding="10">
                                        <Grid ColumnDefinitions="*,80">
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding Title}" FontSize="14" FontWeight="Bold" />
                                                <TextBlock Text="{Binding Description}" TextTrimming="CharacterEllipsis" FontSize="11" />
                                            </StackPanel>
                                            
                                            <CheckBox Grid.Column="1" IsChecked="{Binding IsDone, Mode=TwoWay}"
                                                      Command="{Binding ToggleTaskDoneCommand}"
                                                      Click="OnCheckBoxClicked"
                                                      HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Grid>
        
        <!-- Bottom Bar -->
        <Border Grid.Row="3"
                VerticalAlignment="Bottom">
            <Button Command="{Binding OpenTaskCreationCommand}"
                    CornerRadius="15" Margin="8,10,8,10" Content="Add Task" />
        </Border>
        
    </Grid>

</UserControl>
